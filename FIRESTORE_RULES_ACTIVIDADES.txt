# Reglas de Firestore para Actividades del Sistema

## IMPORTANTE: Agregar estas reglas a Firebase Console

1. Ve a Firebase Console: https://console.firebase.google.com/
2. Selecciona tu proyecto
3. Ve a Firestore Database → Reglas (Rules)
4. Agrega las siguientes reglas para la colección `actividades_sistema`

## Opción 1: Solo Administradores pueden leer actividades

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ... tus reglas existentes ...

    // Reglas para actividades del sistema
    match /actividades_sistema/{actividadId} {
      // Solo administradores pueden leer
      allow read: if request.auth != null &&
                     get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol == 'admin';

      // Cualquier usuario autenticado puede crear actividades
      allow create: if request.auth != null;

      // No permitir actualización ni eliminación
      allow update, delete: if false;
    }
  }
}
```

## Opción 2: Más permisiva (Para desarrollo/testing)

Si estás en fase de desarrollo y quieres probar rápidamente:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ... tus reglas existentes ...

    // Reglas para actividades del sistema (SOLO PARA DESARROLLO)
    match /actividades_sistema/{actividadId} {
      allow read: if request.auth != null;  // Cualquier usuario autenticado
      allow create: if request.auth != null;
      allow update, delete: if false;
    }
  }
}
```

## Opción 3: Reglas completas recomendadas

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Función helper para verificar rol
    function isAdmin() {
      return request.auth != null &&
             get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol == 'admin';
    }

    function isAuthenticated() {
      return request.auth != null;
    }

    // Usuarios
    match /usuarios/{userId} {
      allow read: if isAuthenticated();
      allow create: if true;  // Permitir registro
      allow update: if isAuthenticated() && request.auth.uid == userId;
      allow delete: if isAdmin();
    }

    // Productos
    match /productos/{productId} {
      allow read: if true;  // Todos pueden ver productos
      allow create, update, delete: if isAdmin();
    }

    // Pedidos
    match /pedidos/{pedidoId} {
      allow read: if isAuthenticated() &&
                     (request.auth.uid == resource.data.usuarioId || isAdmin());
      allow create: if isAuthenticated();
      allow update: if isAdmin();
      allow delete: if false;
    }

    // Actividades del Sistema
    match /actividades_sistema/{actividadId} {
      allow read: if isAdmin();  // Solo admins pueden ver
      allow create: if isAuthenticated();  // Cualquier usuario puede crear
      allow update, delete: if false;  // No se permite modificar o eliminar
    }

    // Notificaciones
    match /notificaciones/{notifId} {
      allow read: if isAuthenticated() &&
                     request.auth.uid == resource.data.usuarioId;
      allow create: if isAdmin();
      allow update: if isAuthenticated() &&
                       request.auth.uid == resource.data.usuarioId;
      allow delete: if isAdmin();
    }

    // Información del negocio
    match /informacion_negocio/{doc} {
      allow read: if true;  // Todos pueden leer
      allow write: if isAdmin();  // Solo admin puede editar
    }

    // Promociones
    match /promociones/{promoId} {
      allow read: if true;  // Todos pueden ver promociones activas
      allow create, update, delete: if isAdmin();
    }

    // Categorías
    match /categorias/{categoriaId} {
      allow read: if true;
      allow create, update, delete: if isAdmin();
    }
  }
}
```

## Pasos para aplicar las reglas:

1. Copia las reglas que prefieras (recomiendo Opción 1 o 3)
2. Ve a Firebase Console → Firestore Database → Reglas
3. Pega las reglas en el editor
4. Haz clic en "Publicar" (Publish)
5. Espera unos segundos para que se apliquen

## Verificar que funcionan:

Después de aplicar las reglas:
1. Recarga tu aplicación (hot reload)
2. Inicia sesión como administrador
3. Ve al dashboard
4. La sección "Actividad Reciente" debería mostrar:
   - "No hay actividades aún" (si no hay actividades en Firebase)
   - Las actividades reales (si creaste algunas en Firebase Console)

## Nota de Seguridad:

- NUNCA uses reglas permisivas en producción
- Siempre verifica que solo los usuarios autorizados tengan acceso
- Las actividades del sistema deben ser visibles solo para administradores
- Solo usuarios autenticados pueden crear actividades
